<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRF SJÖSTADEN 2 - 3D View</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        #container { width: 100vw; height: 100vh; }
        #info-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255,255,255,0.95); padding: 20px;
            border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 320px; z-index: 100;
        }
        #info-panel h1 { font-size: 18px; margin-bottom: 10px; color: #333; }
        .stat { margin: 8px 0; }
        .stat-label { color: #666; font-size: 12px; }
        .stat-value { font-size: 16px; font-weight: 600; color: #222; }
        #building-info { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; display: none; }
        #building-info.active { display: block; }
        .energy-class { display: inline-block; padding: 4px 12px; border-radius: 4px; font-weight: bold; color: white; }
        .energy-A { background: #00AA00; }
        .energy-B { background: #55FF00; color: #333; }
        #legend { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); padding: 15px; border-radius: 8px; }
        #legend h3 { margin-bottom: 10px; font-size: 14px; }
        .legend-item { display: flex; align-items: center; margin: 5px 0; font-size: 12px; }
        .legend-color { width: 20px; height: 20px; margin-right: 8px; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info-panel">
        <h1>BRF SJÖSTADEN 2</h1>
        <div class="stat">
            <div class="stat-label">Buildings</div>
            <div class="stat-value">2</div>
        </div>
        <div id="building-info">
            <h3 id="building-name">Select a building</h3>
            <div class="stat"><div class="stat-label">Address</div><div class="stat-value" id="building-address">-</div></div>
            <div class="stat"><div class="stat-label">Energy Class</div><div class="stat-value"><span id="building-energy" class="energy-class">-</span></div></div>
            <div class="stat"><div class="stat-label">Height / Floors</div><div class="stat-value"><span id="building-height">-</span>m / <span id="building-floors">-</span> floors</div></div>
            <div class="stat"><div class="stat-label">WWR (avg)</div><div class="stat-value" id="building-wwr">-</div></div>
            <div class="stat"><div class="stat-label">Solar Potential</div><div class="stat-value" id="building-solar">-</div></div>
        </div>
    </div>
    <div id="legend">
        <h3>Energy Class</h3>
        <div class="legend-item"><div class="legend-color" style="background:#00AA00"></div> A</div>
        <div class="legend-item"><div class="legend-color" style="background:#55FF00"></div> B</div>
        <div class="legend-item"><div class="legend-color" style="background:#AAFF00"></div> C</div>
        <div class="legend-item"><div class="legend-color" style="background:#FFFF00"></div> D</div>
    </div>
    <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        const sceneData = {"metadata": {"brf_name": "BRF SJ\u00d6STADEN 2", "generator": "brf-energy-toolkit", "version": "0.1.0"}, "buildings": [{"id": 1, "name": "Building 1", "address": "Aktergatan 11", "height": 21, "floors": 7, "energy_class": "B", "color": 5635840, "geometry": {"wall_vertices": [-11.566451612859964, 0, -26.671290322206914, -1.9164516128366813, 0, -32.54129032231867, -1.9164516128366813, 21, -32.54129032231867, -11.566451612859964, 21, -26.671290322206914, -1.9164516128366813, 0, -32.54129032231867, 0.6735483871307224, 0, -34.111290322616696, 0.6735483871307224, 21, -34.111290322616696, -1.9164516128366813, 21, -32.54129032231867, 0.6735483871307224, 0, -34.111290322616696, 8.543548387126066, 0, -38.87129032239318, 8.543548387126066, 21, -38.87129032239318, 0.6735483871307224, 21, -34.111290322616696, 8.543548387126066, 0, -38.87129032239318, 19.533548387116753, 0, -19.351290322840214, 19.533548387116753, 21, -19.351290322840214, 8.543548387126066, 21, -38.87129032239318, 19.533548387116753, 0, -19.351290322840214, 33.69354838714935, 0, 6.698709677904844, 33.69354838714935, 21, 6.698709677904844, 19.533548387116753, 21, -19.351290322840214, 33.69354838714935, 0, 6.698709677904844, 24.603548387181945, 0, 12.208709677681327, 24.603548387181945, 21, 12.208709677681327, 33.69354838714935, 21, 6.698709677904844, 24.603548387181945, 0, 12.208709677681327, 23.823548387154005, 0, 12.678709677420557, 23.823548387154005, 21, 12.678709677420557, 24.603548387181945, 21, 12.208709677681327, 23.823548387154005, 0, 12.678709677420557, 4.953548387158662, 0, -18.40129032265395, 4.953548387158662, 21, -18.40129032265395, 23.823548387154005, 21, 12.678709677420557, 4.953548387158662, 0, -18.40129032265395, -0.06645161285996437, 0, -15.351290322840214, -0.06645161285996437, 21, -15.351290322840214, 4.953548387158662, 21, -18.40129032265395, -0.06645161285996437, 0, -15.351290322840214, -2.846451612887904, 0, -17.791290322318673, -2.846451612887904, 21, -17.791290322318673, -0.06645161285996437, 21, -15.351290322840214, -2.846451612887904, 0, -17.791290322318673, -5.576451612869278, 0, -20.491290322504938, -5.576451612869278, 21, -20.491290322504938, -2.846451612887904, 21, -17.791290322318673, -5.576451612869278, 0, -20.491290322504938, -10.306451612850651, 0, -24.56129032280296, -10.306451612850651, 21, -24.56129032280296, -5.576451612869278, 21, -20.491290322504938, -10.306451612850651, 0, -24.56129032280296, -11.566451612859964, 0, -26.671290322206914, -11.566451612859964, 21, -26.671290322206914, -10.306451612850651, 21, -24.56129032280296], "wall_normals": [-0.5196941445129338, 0, -0.8543523840658314, -0.5196941445129338, 0, -0.8543523840658314, -0.5196941445129338, 0, -0.8543523840658314, -0.5196941445129338, 0, -0.8543523840658314, -0.5183748894099247, 0, -0.8551534798088869, -0.5183748894099247, 0, -0.8551534798088869, -0.5183748894099247, 0, -0.8551534798088869, -0.5183748894099247, 0, -0.8551534798088869, -0.5175304276758483, 0, -0.8556648037810446, -0.5175304276758483, 0, -0.8556648037810446, -0.5175304276758483, 0, -0.8556648037810446, -0.5175304276758483, 0, -0.8556648037810446, 0.8713847219527969, 0, -0.4906003122168257, 0.8713847219527969, 0, -0.4906003122168257, 0.8713847219527969, 0, -0.4906003122168257, 0.8713847219527969, 0, -0.4906003122168257, 0.8785906695407729, 0, -0.47757558082035173, 0.8785906695407729, 0, -0.47757558082035173, 0.8785906695407729, 0, -0.47757558082035173, 0.8785906695407729, 0, -0.47757558082035173, 0.5183642642087504, 0, 0.8551599204776384, 0.5183642642087504, 0, 0.8551599204776384, 0.5183642642087504, 0, 0.8551599204776384, 0.5183642642087504, 0, 0.8551599204776384, 0.5161097042568755, 0, 0.8565224884215712, 0.5161097042568755, 0, 0.8565224884215712, 0.5161097042568755, 0, 0.8565224884215712, 0.5161097042568755, 0, 0.8565224884215712, -0.8547875152223378, 0, 0.5189781342407614, -0.8547875152223378, 0, 0.5189781342407614, -0.8547875152223378, 0, 0.5189781342407614, -0.8547875152223378, 0, 0.5189781342407614, 0.519244660870528, 0, 0.8546256386029208, 0.519244660870528, 0, 0.8546256386029208, 0.519244660870528, 0, 0.8546256386029208, 0.519244660870528, 0, 0.8546256386029208, -0.6596522274186151, 0, 0.7515709805877685, -0.6596522274186151, 0, 0.7515709805877685, -0.6596522274186151, 0, 0.7515709805877685, -0.6596522274186151, 0, 0.7515709805877685, -0.7031893818849438, 0, 0.7110025971853201, -0.7031893818849438, 0, 0.7110025971853201, -0.7031893818849438, 0, 0.7110025971853201, -0.7031893818849438, 0, 0.7110025971853201, -0.6522419146793402, 0, 0.7580108737580407, -0.6522419146793402, 0, 0.7580108737580407, -0.6522419146793402, 0, 0.7580108737580407, -0.6522419146793402, 0, 0.7580108737580407, -0.8585681462595337, 0, 0.5126994618960196, -0.8585681462595337, 0, 0.5126994618960196, -0.8585681462595337, 0, 0.5126994618960196, -0.8585681462595337, 0, 0.5126994618960196], "wall_indices": [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23, 24, 25, 26, 24, 26, 27, 28, 29, 30, 28, 30, 31, 32, 33, 34, 32, 34, 35, 36, 37, 38, 36, 38, 39, 40, 41, 42, 40, 42, 43, 44, 45, 46, 44, 46, 47, 48, 49, 50, 48, 50, 51], "cap_vertices": [-11.566451612859964, 0, -26.671290322206914, -1.9164516128366813, 0, -32.54129032231867, 0.6735483871307224, 0, -34.111290322616696, 8.543548387126066, 0, -38.87129032239318, 19.533548387116753, 0, -19.351290322840214, 33.69354838714935, 0, 6.698709677904844, 24.603548387181945, 0, 12.208709677681327, 23.823548387154005, 0, 12.678709677420557, 4.953548387158662, 0, -18.40129032265395, -0.06645161285996437, 0, -15.351290322840214, -2.846451612887904, 0, -17.791290322318673, -5.576451612869278, 0, -20.491290322504938, -10.306451612850651, 0, -24.56129032280296, -11.566451612859964, 21, -26.671290322206914, -1.9164516128366813, 21, -32.54129032231867, 0.6735483871307224, 21, -34.111290322616696, 8.543548387126066, 21, -38.87129032239318, 19.533548387116753, 21, -19.351290322840214, 33.69354838714935, 21, 6.698709677904844, 24.603548387181945, 21, 12.208709677681327, 23.823548387154005, 21, 12.678709677420557, 4.953548387158662, 21, -18.40129032265395, -0.06645161285996437, 21, -15.351290322840214, -2.846451612887904, 21, -17.791290322318673, -5.576451612869278, 21, -20.491290322504938, -10.306451612850651, 21, -24.56129032280296], "cap_normals": [0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0], "bottom_indices": [0, 2, 1, 0, 3, 2, 0, 4, 3, 0, 5, 4, 0, 6, 5, 0, 7, 6, 0, 8, 7, 0, 9, 8, 0, 10, 9, 0, 11, 10, 0, 12, 11], "top_indices": [13, 14, 15, 13, 15, 16, 13, 16, 17, 13, 17, 18, 13, 18, 19, 13, 19, 20, 13, 20, 21, 13, 21, 22, 13, 22, 23, 13, 23, 24, 13, 24, 25]}, "enriched": {"wwr": {"north": 0.21600000000000003, "south": 0.324, "east": 0.27, "west": 0.27, "average": 0.17132233511688838, "source": "era_estimation", "confidence": 0.5, "ai_detected": 0.10553722519481394, "ai_confidence": "medium"}, "solar_potential_kwh": 40073.869291627176}}, {"id": 2, "name": "Building 2", "address": "Aktergatan 11", "height": 21, "floors": 7, "energy_class": "B", "color": 5635840, "geometry": {"wall_vertices": [29.703548387158662, 0, 69.68870967719704, 23.003548387205228, 0, 73.75870967749506, 23.003548387205228, 21, 73.75870967749506, 29.703548387158662, 21, 69.68870967719704, 23.003548387205228, 0, 73.75870967749506, 19.44354838714935, 0, 75.92870967742056, 19.44354838714935, 21, 75.92870967742056, 23.003548387205228, 21, 73.75870967749506, 19.44354838714935, 0, 75.92870967742056, 16.83354838716332, 0, 71.61870967783034, 16.83354838716332, 21, 71.61870967783034, 19.44354838714935, 21, 75.92870967742056, 16.83354838716332, 0, 71.61870967783034, -20.346451612887904, 0, 10.34870967734605, -20.346451612887904, 21, 10.34870967734605, 16.83354838716332, 21, 71.61870967783034, -20.346451612887904, 0, 10.34870967734605, -25.826451612869278, 0, 1.3087096773087978, -25.826451612869278, 21, 1.3087096773087978, -20.346451612887904, 21, 10.34870967734605, -25.826451612869278, 0, 1.3087096773087978, -16.256451612804085, 0, -4.561290322802961, -16.256451612804085, 21, -4.561290322802961, -25.826451612869278, 21, 1.3087096773087978, -16.256451612804085, 0, -4.561290322802961, -17.146451612818055, 0, -6.00129032228142, -17.146451612818055, 21, -6.00129032228142, -16.256451612804085, 21, -4.561290322802961, -17.146451612818055, 0, -6.00129032228142, -24.786451612832025, 0, -18.661290322430432, -24.786451612832025, 21, -18.661290322430432, -17.146451612818055, 21, -6.00129032228142, -24.786451612832025, 0, -18.661290322430432, -14.986451612901874, 0, -24.601290322840214, -14.986451612901874, 21, -24.601290322840214, -24.786451612832025, 21, -18.661290322430432, -14.986451612901874, 0, -24.601290322840214, -13.826451612869278, 0, -22.701290322467685, -13.826451612869278, 21, -22.701290322467685, -14.986451612901874, 21, -24.601290322840214, -13.826451612869278, 0, -22.701290322467685, -13.056451612850651, 0, -20.321290322579443, -13.056451612850651, 21, -20.321290322579443, -13.826451612869278, 21, -22.701290322467685, -13.056451612850651, 0, -20.321290322579443, -12.406451612827368, 0, -16.351290322840214, -12.406451612827368, 21, -16.351290322840214, -13.056451612850651, 21, -20.321290322579443, -12.406451612827368, 0, -16.351290322840214, -11.256451612804085, 0, -12.68129032291472, -11.256451612804085, 21, -12.68129032291472, -12.406451612827368, 21, -16.351290322840214, -11.256451612804085, 0, -12.68129032291472, -8.156451612827368, 0, -2.9712903229519725, -8.156451612827368, 21, -2.9712903229519725, -11.256451612804085, 21, -12.68129032291472, -8.156451612827368, 0, -2.9712903229519725, -12.616451612790115, 0, -0.2612903220579028, -12.616451612790115, 21, -0.2612903220579028, -8.156451612827368, 21, -2.9712903229519725, -12.616451612790115, 0, -0.2612903220579028, 29.703548387158662, 0, 69.68870967719704, 29.703548387158662, 21, 69.68870967719704, -12.616451612790115, 21, -0.2612903220579028], "wall_normals": [0.5191778445867241, 0, 0.8546662305779276, 0.5191778445867241, 0, 0.8546662305779276, 0.5191778445867241, 0, 0.8546662305779276, 0.5191778445867241, 0, 0.8546662305779276, 0.5204794833080332, 0, 0.8538741754236409, 0.5204794833080332, 0, 0.8538741754236409, 0.5204794833080332, 0, 0.8538741754236409, 0.5204794833080332, 0, 0.8538741754236409, -0.8553843785759749, 0, 0.5179937884648745, -0.8553843785759749, 0, 0.5179937884648745, -0.8553843785759749, 0, 0.5179937884648745, -0.8553843785759749, 0, 0.5179937884648745, -0.8549090778673758, 0, 0.5187778605337291, -0.8549090778673758, 0, 0.5187778605337291, -0.8549090778673758, 0, 0.5187778605337291, -0.8549090778673758, 0, 0.5187778605337291, -0.8551470035852337, 0, 0.5183855729659116, -0.8551470035852337, 0, 0.5183855729659116, -0.8551470035852337, 0, 0.5183855729659116, -0.8551470035852337, 0, 0.5183855729659116, -0.5228544430949627, 0, -0.852421979617992, -0.5228544430949627, 0, -0.852421979617992, -0.5228544430949627, 0, -0.852421979617992, -0.5228544430949627, 0, -0.852421979617992, -0.8506426037383173, 0, 0.525744387231377, -0.8506426037383173, 0, 0.525744387231377, -0.8506426037383173, 0, 0.525744387231377, -0.8506426037383173, 0, 0.525744387231377, -0.8561773449286866, 0, 0.5166820628112271, -0.8561773449286866, 0, 0.5166820628112271, -0.8561773449286866, 0, 0.5166820628112271, -0.8561773449286866, 0, 0.5166820628112271, -0.5183403948245807, 0, -0.8551743887027358, -0.5183403948245807, 0, -0.8551743887027358, -0.5183403948245807, 0, -0.8551743887027358, -0.5183403948245807, 0, -0.8551743887027358, 0.8535038389115925, 0, -0.5210865541953413, 0.8535038389115925, 0, -0.5210865541953413, 0.8535038389115925, 0, -0.5210865541953413, 0.8535038389115925, 0, -0.5210865541953413, 0.9514445185479972, 0, -0.30782028543448803, 0.9514445185479972, 0, -0.30782028543448803, 0.9514445185479972, 0, -0.30782028543448803, 0.9514445185479972, 0, -0.30782028543448803, 0.9868601732086878, 0, -0.16157660268281074, 0.9868601732086878, 0, -0.16157660268281074, 0.9868601732086878, 0, -0.16157660268281074, 0.9868601732086878, 0, -0.16157660268281074, 0.9542483625290913, 0, -0.29901515448309296, 0.9542483625290913, 0, -0.29901515448309296, 0.9542483625290913, 0, -0.29901515448309296, 0.9542483625290913, 0, -0.29901515448309296, 0.9526289760157335, 0, -0.30413489450442055, 0.9526289760157335, 0, -0.30413489450442055, 0.9526289760157335, 0, -0.30413489450442055, 0.9526289760157335, 0, -0.30413489450442055, 0.5192781155530272, 0, 0.8546053116542729, 0.5192781155530272, 0, 0.8546053116542729, 0.5192781155530272, 0, 0.8546053116542729, 0.5192781155530272, 0, 0.8546053116542729, 0.8555984493030813, 0, -0.5176401197262079, 0.8555984493030813, 0, -0.5176401197262079, 0.8555984493030813, 0, -0.5176401197262079, 0.8555984493030813, 0, -0.5176401197262079], "wall_indices": [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23, 24, 25, 26, 24, 26, 27, 28, 29, 30, 28, 30, 31, 32, 33, 34, 32, 34, 35, 36, 37, 38, 36, 38, 39, 40, 41, 42, 40, 42, 43, 44, 45, 46, 44, 46, 47, 48, 49, 50, 48, 50, 51, 52, 53, 54, 52, 54, 55, 56, 57, 58, 56, 58, 59, 60, 61, 62, 60, 62, 63], "cap_vertices": [29.703548387158662, 0, 69.68870967719704, 23.003548387205228, 0, 73.75870967749506, 19.44354838714935, 0, 75.92870967742056, 16.83354838716332, 0, 71.61870967783034, -20.346451612887904, 0, 10.34870967734605, -25.826451612869278, 0, 1.3087096773087978, -16.256451612804085, 0, -4.561290322802961, -17.146451612818055, 0, -6.00129032228142, -24.786451612832025, 0, -18.661290322430432, -14.986451612901874, 0, -24.601290322840214, -13.826451612869278, 0, -22.701290322467685, -13.056451612850651, 0, -20.321290322579443, -12.406451612827368, 0, -16.351290322840214, -11.256451612804085, 0, -12.68129032291472, -8.156451612827368, 0, -2.9712903229519725, -12.616451612790115, 0, -0.2612903220579028, 29.703548387158662, 21, 69.68870967719704, 23.003548387205228, 21, 73.75870967749506, 19.44354838714935, 21, 75.92870967742056, 16.83354838716332, 21, 71.61870967783034, -20.346451612887904, 21, 10.34870967734605, -25.826451612869278, 21, 1.3087096773087978, -16.256451612804085, 21, -4.561290322802961, -17.146451612818055, 21, -6.00129032228142, -24.786451612832025, 21, -18.661290322430432, -14.986451612901874, 21, -24.601290322840214, -13.826451612869278, 21, -22.701290322467685, -13.056451612850651, 21, -20.321290322579443, -12.406451612827368, 21, -16.351290322840214, -11.256451612804085, 21, -12.68129032291472, -8.156451612827368, 21, -2.9712903229519725, -12.616451612790115, 21, -0.2612903220579028], "cap_normals": [0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0], "bottom_indices": [0, 2, 1, 0, 3, 2, 0, 4, 3, 0, 5, 4, 0, 6, 5, 0, 7, 6, 0, 8, 7, 0, 9, 8, 0, 10, 9, 0, 11, 10, 0, 12, 11, 0, 13, 12, 0, 14, 13, 0, 15, 14], "top_indices": [16, 17, 18, 16, 18, 19, 16, 19, 20, 16, 20, 21, 16, 21, 22, 16, 22, 23, 16, 23, 24, 16, 24, 25, 16, 25, 26, 16, 26, 27, 16, 27, 28, 16, 28, 29, 16, 29, 30, 16, 30, 31]}, "enriched": {"wwr": {"north": 0.21600000000000003, "south": 0.324, "east": 0.27, "west": 0.27, "average": 0.17132233511688838, "source": "era_estimation", "confidence": 0.5, "ai_detected": 0.10553722519481394, "ai_confidence": "medium"}, "solar_potential_kwh": 40079.39961046911}}]};
        const container = document.getElementById('container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(100, 80, 100);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 15, 0);
        controls.enableDamping = true;
        controls.update();
        scene.add(new THREE.AmbientLight(0x404040, 0.5));
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(100, 100, 50);
        sun.castShadow = true;
        scene.add(sun);
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(300, 300),
            new THREE.MeshStandardMaterial({ color: 0x3a5f0b, roughness: 0.9 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.1;
        ground.receiveShadow = true;
        scene.add(ground);
        const buildings = [];
        const buildingMeshes = new Map();
        for (const building of sceneData.buildings) {
            const group = new THREE.Group();
            group.userData = building;
            const geom = building.geometry;
            const wallGeometry = new THREE.BufferGeometry();
            wallGeometry.setAttribute('position', new THREE.Float32BufferAttribute(geom.wall_vertices, 3));
            wallGeometry.setAttribute('normal', new THREE.Float32BufferAttribute(geom.wall_normals, 3));
            wallGeometry.setIndex(geom.wall_indices);
            const wallMaterial = new THREE.MeshStandardMaterial({ color: building.color, roughness: 0.7 });
            const wallMesh = new THREE.Mesh(wallGeometry, wallMaterial);
            wallMesh.castShadow = true;
            group.add(wallMesh);
            const capGeometry = new THREE.BufferGeometry();
            capGeometry.setAttribute('position', new THREE.Float32BufferAttribute(geom.cap_vertices, 3));
            capGeometry.setAttribute('normal', new THREE.Float32BufferAttribute(geom.cap_normals, 3));
            capGeometry.setIndex([...geom.bottom_indices, ...geom.top_indices]);
            const capMaterial = new THREE.MeshStandardMaterial({ color: building.color, roughness: 0.8 });
            const capMesh = new THREE.Mesh(capGeometry, capMaterial);
            capMesh.castShadow = true;
            group.add(capMesh);
            scene.add(group);
            buildings.push(group);
            buildingMeshes.set(building.id, { group, wallMaterial, capMaterial });
        }
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedBuilding = null;
        container.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(buildings, true);
            if (intersects.length > 0) {
                const b = intersects[0].object.parent.userData;
                document.getElementById('building-info').classList.add('active');
                document.getElementById('building-name').textContent = b.name;
                document.getElementById('building-address').textContent = b.address;
                document.getElementById('building-height').textContent = b.height.toFixed(1);
                document.getElementById('building-floors').textContent = b.floors;
                document.getElementById('building-wwr').textContent = (b.enriched?.wwr?.average * 100 || 0).toFixed(0) + '%';
                document.getElementById('building-solar').textContent = (b.enriched?.solar_potential_kwh || 0).toLocaleString() + ' kWh/yr';
                const energyEl = document.getElementById('building-energy');
                energyEl.textContent = b.energy_class;
                energyEl.className = 'energy-class energy-' + b.energy_class;
                if (selectedBuilding) {
                    const prev = buildingMeshes.get(selectedBuilding);
                    prev.wallMaterial.emissive.setHex(0x000000);
                    prev.capMaterial.emissive.setHex(0x000000);
                }
                selectedBuilding = b.id;
                const curr = buildingMeshes.get(selectedBuilding);
                curr.wallMaterial.emissive.setHex(0x333333);
                curr.capMaterial.emissive.setHex(0x333333);
            }
        });
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>